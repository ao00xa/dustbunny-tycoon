\chapter{Project Premise and Model Design} 

\section{Premise}

%TODO: need to discuss ferry characteristics - task oriented


Message ferrying, also known as store-carry-forward, is the approach of physically carrying data from nodes that are out of range and deliver them to their destination. 
Some of the advantages of message ferries are that they virtually do not require physical infrastructure and that they also have a low cost. 

	
\subsection{Application Characteristics and Requirements}

Any application running over a message ferrying network must have the following characteristics:

\begin{description}
\item[Delay Tolerance: ]
Since data is transported by a physical device, significant delays of minutes to hours must be expected.
\item[Loss Tolerance: ]
Given that ferries have limited memory, loss of data must be expected.
\item[Small and Independent Messages: ]
Following from the limited memory capacity of ferries and the high probability of packet loss, a reliable method for segmentation and reassembly of messages should not be expected. 
Applications should limit the size of messages such that the can be transmitted in their entirety using one network packet.
%Use PDU instead of packet?
%
(See section \ref{sec:fountain_codes} for future work)
\end{description}

Given these criteria, a message ferrying network is unsuitable for many typical networking applications including web browsing, real-time voice or text communication and file transfer.
As such, a very specialized 'state monitoring' network designed for non-critical monitoring of remote sensors is considered.

\subsection{State Monitoring Network}

The general premise for this project consists of a network containing numerous, uniquely identifiable source nodes. 
Each source node has a limited number of properties, in the form of key/value pairs, specifying a property name (the key) and its current value.
Properties may change overtime and each change defines a new state for the source node.
A temperature sensor for example, might support a 'temperature' property, the value of which is the current temperature updated every hour.
Properties do not have to contain a single value and each may be as large as the payload limit of network packets. %Somewhat of a vague statement

%TODO: introduction to node types
%	Perhaps put in the Network Elements section below
%
%This needs to be broken into an new section or placed in a subsection



%TODO: new section

The network and message ferrying algorithm is designed to synchronize a central repository with the current state of every source node.
Only the most recent state (or most recent value) for each property is important, not the history of how that property has changed.
This limits the number of packets which can exist in the network as only the most recent update must be reported.
%The significance of this characteristic is described below. 
The message ferries collect data from source nodes when they are in range and transport it to the central repository.
The central repository is assumed to be a server connected to the Internet.
Ferries pass updates they have collected from source nodes to special gateway nodes.
These gateway nodes are then responsible for using a reliable delivery mechanism over a standard IP network to update the central repository.

\emph{Insert image showing this process.}

%--------------------------------------------------------------------------------------------------------
% 		Design
%--------------------------------------------------------------------------------------------------------
\section{Modal Design}
\subsection{Network Elements}


%This section describes the elements present in the network.

\subsubsection{Nodes}

The network is comprised of three types of nodes:

\begin{description}

\item[Source Node: ] 
Static nodes in the network which have a set of properties (key/value pairs).
After a property of a source changes, known as a state change, it attempt to notify the central repository by transferring update packets to message ferries.
A source node could be, for example, a remote temperature sensor.
\item[Message Ferry: ] 
A mobile node which collects updates from source nodes when they are in range.
Message ferries store update packets from source nodes within a buffer. 
When in range, these update packets are forwarded to gateway nodes.
A source node could be, for example, a specially equipt cell phone or a small computer attached to a vehicle. 
\item[Gateway: ]
Gateway nodes download update packets form message ferries and forward them to the central repository over the Internet.
Transfer of updates between the gateway and central repository is assumed to be reliable. 

\end{description}


Sources have properties (prop1, prop2, etc) which generate messages. These messages get carried to any gateway node by message ferries.

\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{images/source}
    \caption{Source Node Model}
    \label{fig:source}
\end{figure}

Source node shown in figure \ref{fig:source} is a static node in the network which have a set of properties that generate update messages. 	
%TODO: Dont use "shown above" - use \ref{} for the figure number
%\item[Central Repository: ] 
%The central repository is a server and the final destination for updates sent from source nodes.
%It maintains a list of the current state of all source nodes.
%There is only one central repository node.


\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{images/ferry}
    \caption{Ferry Node}
    \label{fig:Ferry}
\end{figure}

Ferry Node shown in figure \ref{fig:Ferry} is a mobile node which collects updates from source nodes when they are in range. These updates are then stored in memory.

\begin{figure}[h]
    \centering
    \includegraphics[width=.5\textwidth]{images/gateway}
    \caption{Gateway Node}
    \label{fig:Gateway}
\end{figure}

Gateway Node shown in figure \ref{fig:Gateway} receives the update messages from ferries and forwards them to their final destination via the Internet. 



\subsubsection{Properties}

Source node has three main pieces of data:
\begin{itemize}
\item Source ID
\item Key
\item Key update number
\end{itemize}

Note that the key update number is extremely important because it lets the ferry know of the most recent update.


\subsubsection{Packets}

At the network layer, two types of packets are used as follows:

\begin{description}
\item[Update Packet: ]
Update packets are generated by source nodes when a message ferry is in range and their state has changed. 
Source nodes will continue to generate update packets until the state change is acknowledged by the central repository (using an acknowledgment packet).
\item[Beacon Packet: ] 
Beacon packets are first generated by ferry nodes to discover if there are source nodes in range. 
When there are source nodes in range, they give their updates to the ferries. Similar procedure happens between the ferry and source nodes. 
%TODO:  Why range is 60m
\end{description}

%--------------------------------------------------------------------------------------------------------
% 		Algorithm
%--------------------------------------------------------------------------------------------------------
\subsection{Algorithm and Behavior - Simplified}

\subsubsection{Ferry Algorithm}

Ferry nodes do the steps shown below in order:

\begin{enumerate}
\item Move around sending beacons to notify other nodes that there is a ferry in range.
\item When a source node is in range, the ferry node receives the updates from it.
\item Ferry nodes only keep the most recent update according to the key update number and age.
	\begin{enumerate}
	\item It compares the updates and keeps the most recent according to the key update.
	\item If a ferry gets full, it considers the age and gets rid of the oldest update
	\end{enumerate}
\item It then moves till a gateway beacon is received.
\item Ferry node then sends the updates to the gateway.
\end{enumerate}

\subsubsection{Source Algorithm}

Source nodes do the steps shown below in order:

\begin{enumerate}
\item They wait till a beacon is receive from the ferry node.
\item Based on the current state, key update,  they send three properties to the ferry node.

\end{enumerate}


\subsubsection{Gateway Algorithm}

Gateway nodes do the steps shown below in order:

\begin{enumerate}
\item Gateway nodes notify ferries that there's a beacon in range.
\item Ferries then send their most recent update to the gateway nodes.
\item Gateway nodes receives these updates.
\item Records that an update has been received.
\end{enumerate}



%--------------------------------------------------------------------------------------------------------
% 		Other stuff to include
%--------------------------------------------------------------------------------------------------------

%TODO: Talk about layer 1 and 2 assumptions we are making
%	- No unintentional loss (ie from rf interference)
%	- No propagation and transmission delay
%	- COmmunication range - 60 m - inside nodes can communicate and outisde they cannot

%TODO: Talk about various process models and their roles
%	- Major improvement -> better mac

\input{chapters/validation}